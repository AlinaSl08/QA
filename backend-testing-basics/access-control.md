# Управление доступом

**Ключевые понятия**:

+ **Идентификация** – установление личности субъекта доступа.

>Пример: пользователь вводит логин (имя пользователя, e-mail, номер телефона и т.п.).

+ **Аутентификация** – проверка подлинности субъекта доступа.

>Пример: пользователь вводит пароль, проходит проверку одноразовым кодом, подтверждает вход по сертификату и т.д.

+ **Авторизация** – определение прав доступа аутентифицированного субъекта.

>Пример: системе известно, что пользователь – администратор, и она разрешает ему создавать и удалять учетные записи, но обычным пользователям – нет.

 

**Пример типичной цепочки**:

1. **Идентификация**:

Пользователь вводит логин (`user@example.com`).

2. **Аутентификация**:

Пользователь вводит пароль.
Система сверяет введённый пароль с сохранённым хешем (пароли в базе данных хешируются)и принимает решение: пропустить или отказать.

3. **Авторизация**:

После успешной аутентификации система определяет роль пользователя (например, `admin`, `manager`, `user`) и в соответствии с ней разрешает или запрещает выполнение операций (просмотр, изменение, удаление данных и т.п.).

---

**Основные виды аутентификации**:

**1. Basic Authentication**

**Как работает**:

1, Клиент формирует строку вида username:password
2, Строка кодируется в Base64
3, Полученное значение передаётся в HTTP-заголовке Authorization

Пример заголовка:
```
Authorization: Basic dNXlcjpwYXNz
```
                  
>Важно: Base64 – это кодирование, а не шифрование. Данные легко восстановить из заголовка.

 

**2. Digest Authentication**

**Как работает**:

Пароль не передаётся по сети. Вместо этого клиент и сервер обмениваются хешами (обычно MD5), вычисленными на основе:

+ логина
+ пароля (только на стороне клиента)
+ URI запрашиваемого ресурса
+ случайного значения (nonce), сгенерированного сервером
 

**3. Session-based Authentication (сессионная аутентификация)**

**Как работает**:

1. Пользователь аутентифицируется (например, по логину и паролю)
2. Сервер создаёт запись сессии (например, в базе данных или в памяти) и присваивает ей уникальный идентификатор – `session ID`
3. `session ID` возвращается клиенту (чаще всего через cookie)
4. При каждом последующем запросе клиент автоматически отправляет `session ID`
5. Сервер по `session ID` восстанавливает контекст пользователя (его идентификатор, роль и др.)
 

**4. Token-based Authentication (аутентификация на основе токенов)**

**Как работает**:

После успешной аутентификации сервер выдаёт клиенту **токен**.
При последующих запросах клиент передаёт токен, обычно в заголовке:
```
Authorization: Bearer <token>
```
                  
Сервер по токену определяет пользователя и его права.

 
**Виды токенов**:

**1. JWT (JSON Web Token)**

Структура:

+ Заголовок (header) — алгоритм подписи и тип токена
+ Полезная нагрузка (payload) — данные пользователя (claims)
+ Подпись (signature) — криптографическая подпись для проверки целостности

**Пример токена** (упрощённо):
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
```
                  
 

**2. Opaque-токены (непрозрачные, Bearer-токены)**

+ Представляют собой случайную строку
+ Не несут смысла сами по себе; информация о них хранится на сервере (в базе данных)

**Пример токена** (упрощённо):
```
ory_at_JGhESDjKfHMQ8Wcy0cC3.hIQxGmX37ydn8WmKAnlD3U
```
